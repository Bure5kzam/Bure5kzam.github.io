---
layout: single
title: 리눅스 유저
date: 2022-07-10 12:25
category: LinuxMaster
---
# Overview
리눅스 시스템은 시스템 하나에 여러 사람이 원격으로 접속해서 사용하는 구조로 되어있습니다. 70년대에는 컴퓨터가 너무 비쌌고 네트워크같은 인프라를 구축하는데도 비용이 많이 들었기 때문에 대부분의 컴퓨터는 기관에서 보유하고 있었습니다. 

그래서 리눅스는 컴퓨터가 없는 사람들도 원격으로 접속해서 사용할 수 있는 구조로 되어있습니다.
여러 사람들이 사용하는 시스템이다 보니 다른 사람의 파일을 허락없이 건들지 못하도록 유저와 그룹 개념이 존재합니다.

##User
 처음 시스템을 구축하면 sudo 권한을 가진 root 계정만이 존재합니다. 시스템 관리자는 이 계정으로 접속해 유저관리를 합니다.
 
 UID는 시스템에서 유저를 식별하기 위해 만든 0이상의 정수이며 UID가 0인 계정은 Super User 권한을 갖습니다.

 시스템 내 유저 정보는 /etc/passwd와 /etc/shadow에 저장되는데, 각자 다른 정보를 관리하고 있습니다.

# Files
유저 정보 파일은 두가지로 나눠져있습니다.
`/etc/password`는 유저의 정보(UID, Comment, home directory) 등을 관리하며
`/etc/shadow`는 유저의 Password Aging에 사용됩니다.

> Password Aging : 패스워드의 유효기간과 교체 주기를 관리하는 파일

## /etc/passwd
 콘솔에 `man 5 passwd`를 입력해 passwd의 구성을 볼 수 있습니다. OS에 매뉴얼이 없으면 안될 수도 있습니다. 

```console
# Means of /etc/passwd
NAME:PW:UID:GID:GECOS:HOME_DIR:SHELL
```

1. 유저 이름
2. 비밀번호
3. 유저에 할당된 ID
4. 유저가 속한 주 그룹 GID,(보조 그룹들은 /etc/group에 명시되어있음)
5. 유저 코멘트
6. 유저의 홈 디렉토리
7. 유저가 사용할 쉘 path

## /etc/shadow
암호화된 패스워드와 에이징을 관리를 위해 존재하는 파일입니다.
쉘 명령어 중 passwd로 끝나는 것들은 종종 password aging 와 관련이 있어 shadow 파일의 역할을 알면 기능을 알기 쉽습니다. 주로 명령어로 관리하기 때문에 값을 직접 수정하는 일이 없습니다.

`/etc/shadow` 파일의 필드별 정보는 다음과 같습니다.

```console
NAME:PASSWD:LAST_CHANGED:MINIMUM:MAXIMUM:WARN, 
```

1. NAME : 유저 이름
2. PASSWD : 암호화된 비밀번호.
   1. !로 시작되는 경우, 비밀번호가 잠겼음을 의미
3. LAST_CHANGED : 마지막 변경 날짜.
   1. 1970.01.01.에서부터 지난 일 수를 숫자로 나타냄
   2. 0은 다음에 로그인할 때 변경해야 함을 의미
   3. Empty는 Password Aging이 불가능함을 의미
4. MINIMUM_PERIOD : 비밀번호 변경 후 유지해야 하는 일 수
5. MAXIMUM_PERIOD : 변경 후 번호를 사용할 수 있는 최대 일 수, 만료까지 남은 일 수
6. WARNNING_PERIOD : 번호 만기 경고를 만기 몇일 전에 알릴 건지 일 수 를 설정
7. INACTIVITY_PERIOD : 만료 후 사용자 계정이 비활성화되기 까지의 일 수
   1. 1970.01.01.로부터 지난 일 수
8. EXPIRED_DATE : 계정이 비활성화 될 날짜
9. UNUSED : 향후 사용을 위해 존재만하는 빈 필드


## /etc/skel/
유저 디폴트 디렉토리 구조를 갖고 있는 경로입니다.
유저를 생성할 때 `/etc/skel/`의 디렉토리 구조를 복사해서 생성합니다.

# Commands

## $useradd
유저를 생성하거나 업데이트합니다.
-D(default) 옵션과 함께 사용하면 기본값을 업데이트 하도록 동작합니다.

```
useradd [options] LOGIN
useradd -D
useradd -D [options]
```


**홈 디렉토리에 관한 옵션**


| 주요 옵션                 | 내용                                                                                                                                                                                                                                                                                                                          |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                           |                                                                                                                                                                                                                                                                                                                               |
| -m, --create-home         | home_dir 를 새로 생성하는 옵션. <br/> `-k` 옵션과 함께 사용해 디렉토리 구성을 참조할 skeletone_dir 경로를 명시해야함.  <br/> `-m` 옵션이 없고 CREATE_HOME이 enable 이면 홈디렉토리가 생성되지 않습니다.                                                                                                                       |
| -k, --skel  _SKEL_DIR_    | `-m`와 함께만 사용되는 옵션. skeletone_dir 경로 지정. <br/> 기본값은 `/etc/default/useradd`의 `SKEL` 변수의 값이나 `/etc/skel`                                                                                                                                                                                                |
| -d, --home-dir _HOME-DIR_ | 새 유저는 유저 로그인 디렉토리로서 HOME_DIR가 생성됩니다. 만약 HOME_DIR이 존재하지 않으면 생성할 수 없으며 폴더를 생성하는 `-m` 옵션을 사용해야 합니다.<br/> 기본값은 BASE_DIR에 LOGIN name을 합쳐 login directory name으로 사용합니다.                                                                                       |
| -b, --base-dir _BASE-DIR_ | `-d` 가 없을 때 사용됩니다.                                                                                                                                                                                                             `-m`도 없다면 꼭 필요합니다. <br/> 기본값은 `/etc/default/useradd`의 HOME 필드입니다. |


~~기본값은 `/etc/default/useradd`의 HOME 값이며 `-b` 옵션으로 지정.~~ 

**UID 관련 옵션**

| 주요 옵션        | 내용                                                      |
| ---------------- | --------------------------------------------------------- |
| -u, --uid        | uid 지정 <br/> `-o` 옵션과 함께 쓰면 unique하지 않아도됨. |
| -o, --non-unique | UID를 중복 허용                                           |


**GID 관련 옵션**

| 주요 옵션                         | 내용                                                                                                                                                                                                                                                                                                                                       |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| -g, --gid _GROUP_                 | 로그인시 적용될 그룹을 지정합니다. 기본값은 `/etc/login.defs`의 `USERGROUPS_ENAB`와 커맨드 옵션 `-U` 여부에 따라 다르게 동작합니다. <br/> yes이거나 `-U, --user-group`와 함께 사용 - 유저 이름과 같은 그룹이 생성되고 적용됩니다. <br/> no 거나 `-N, --no-user-group`과 함께 사용 - `/etc/default/useradd`의 `GROUP` 필드 값을 적용합니다. |
| -U, --user-group                  | 그룹값을 유저 이름과 동일하게 설정합니다.                                                                                                                                                                                                                                                                                                  |
| -N, --no-user-group               | 그룹값을 `/etc/default/useradd`의 `GROUP` 필드를 참조해 지정합니다.                                                                                                                                                                                                                                                                        |
| -G, --groups _GROUP1_[,GROUP2...] | 보조 그룹들을 설정합니다. 각 그룹은 공백없이 ,로 구분됩니다.                                                                                                                                                                                                                                                                               |


**기타 지정 옵션**

| 주요 옵션                      | 내용                                                                                                                              |
| ------------------------------ | --------------------------------------------------------------------------------------------------------------------------------- |
| -p, --password _password_      | 패스워드 지정                                                                                                                     |
| -c, --comment _comment_        | 코맨트 지정                                                                                                                       |
| -e, --expiredate _EXPIRE-DATE_ | 만기날짜 지정, 포맷은 YYYY-MM-DD.<br/> empty string은 no expire를 의미.                                                           |
| -f, --expiredate _EXPIRE-DATE_ | 만기된 후 계정이 **영원히(permanetly)** 활성화 하기까지의 일 수 지정. <br/> 0은 만기되자마자 비활성화. <br/> -1 은 기능 비활성화. |


**default 관련 옵션**

유저를 생성할 때 -D옵션과 함께 사용하면 다른 옵션에 기본값을 적용합니다. -D에 다른 옵션들을 같이 사용하면 기본값을 입력값으로 업데이트합니다. 경로는 `/etc/default/useradd`입니다.

| 주요 옵션         | 내용                                                                        |
| ----------------- | --------------------------------------------------------------------------- |
| -b, --base-dir    | 기본 디렉토리 경로. 필드는 HOME                                             |
| -g, --gid         | 기본 그룹. 필드는 GROUP.                                                    |
| -s, --shell       | 기본 쉘 지정 필드는 SHELL.                                                  |
| -e, --expireddate | 계정 비밀번호가 만료될 날짜를 지정합니다. 필드는 EXPIRE.                    |
| -f, --inactive    | expired 되면 몇일 뒤에 계정을 사용할 수 없게할지 정합니다. 필드는 INACTIVE. |

## $usermod

**그룹 추가, 수정**

| 옵션                           | 내용                                                                                                                       |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------- |
| -aG, --append, --gid _GROUP_   | 유저를 supplementary 그룹에 추가합니다. <br/>                                                                              |
| -g, --gid _GROUP_              | Primary Group을 변경합니다.                                                                                                |
| -G, --groups _GROUPS_,_GROUP2_ | Secondary Groups를 설정합니다. 각 그룹은 공백없는 콤마로 구분합니다. 수정 시 명령어에 추가하지 않은 그룹에서는 제외됩니다. |

| 옵션                    | 내용                      |
| ----------------------- | ------------------------- |
| -c, --comment _COMMENT_ | 코멘트를 수정합니다.      |
| -d, --home _HOME-DIR_   | 디렉토리를 수정합니다.    |
| -l, --login _NEW-LOGIN_ | 로그인 계정을 변경합니다. |


## $userdel
유저 계정을 삭제합니다.

| 옵션 | 내용                                                                                                                                     |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| -f   | 강제로 제거합니다. 사용자가 로그인했을 때,메일 스풀이 없을 때, 사용자와 동일한 이름의 그룹이 다른 유저의 Primary Group일때도 삭제합니다. |
| -r   | 홈디렉토리와 메일 스풀을 삭제합니다.                                                                                                     |

## $chage
change user password expiry information.
입력한 유저의 Password aging을 수행합니다.

```console
chage [options] LOGIN
```

**에이징 정보 변경**

| 옵션                           | 내용                                                                                              |
| ------------------------------ | ------------------------------------------------------------------------------------------------- |
| -d, --lastday _LASTDAY_        | 마지막 변경 날 짜 설정                                                                            |
| -m, --mindays _MIN-DAYS_       | 최소 기한                                                                                         |
| -M, --maxdays _MAX-DAYS_       | 최대 기한                                                                                         |
| -W, --warndays _WARN-DAYS_     | 패스워드 만료 경고를 몇일 전에 나타낼지                                                           |
| -I, --inactive _INACTIVE_      | 비밀번호 만료 후 몇일 뒤에 계정이 잠길 것인지. 이 기한이 지나면 시스템 관리자에게 문의해야합니다. |
| -E, --expiredate _EXPIRE-DATE_ | 1970.1.1. 로부터 몇일 뒤에 종료 될지 날 수를 지정.                                                |
| None                           | 모든 필드에 대한 입력을 받음                                                                      |

**정보 출력**

| 옵션       | 내용                      |
| ---------- | ------------------------- |
| -l, --list | 유저의 리스트 정보를 출력 |

## $pwck
`/etc/passwd`와 `/etc/shadow`파일의 무결성을 검사합니다.

