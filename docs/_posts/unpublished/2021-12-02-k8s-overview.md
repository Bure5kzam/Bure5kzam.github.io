---
layout: single
title: 쿠버네티스 개론
date: 2021-12-02 07:21
category: [TIL, k8s]
author: 
tags: [k8s]
summary: 
---
# 모놀로식 아키텍처란
- 전통적인 아키텍처
- 하나의 애플리케이션으로 돌아가는 구조
- 기존 개발 방식을 사용해 간단히 배포


# 모놀리식 서비스 아키텍처의 단점
- 스케일링 할 때 서비스를 그대로 복제해서 로드밸런싱 하므로 불필요한 서비스 까지 모두 복제
- 서비스마다 다른 버전의 라이브러리를 사용해야할 수 있는데, 종속 라이브러리 충돌이 일어날 수 있음.
- 조금만 수정해도 전체 빌드 및 배포 해야함.

# 마이크로 서비스 아키텍처의 장점
- 서비스 단위 빠른 개발
- 배포가 용이함. 개별 서비스 단위로 개발, 패키징, 빌드, 테스트, 배포로 각 서비스마다 유연한 스케줄
- 고효율 저비용 Scale-Out: 서비스 단위로 스케일링 가능해 불필요한 서비스는 줄이고 더 많은 자원이 필요한 서비스는 확장 가능
- 분산 환경에서의 Transaction 보장, 테스트, 배포, 관리 복잡

# 컨테이너
- 가장머신을 사용해 마이크로 서비스를 격리하는 기술
  - 네임스페이스을 구분해 독립 뷰를 제공
  - 리눅스 컨트롤 그룹 : 프로세스로 소비할 수 있는 리소스 양(CPU, 메모리, I/O, 네트워크 대역대, device 노드 등)을 제한
- 하드웨어를 전부 구현하지 않기 때문에 가상머신보다 빠른 실행이 가능
  - Hypervisor : 하드웨어를 가상화 구현하는 과정

# 도커 아키텍처
- Docker engine: 이미지, 네트워크, 디스크 등의 관리 역할
- Containerd: OCI 구현체를 이용해 container를 관리해주는 daemon

웃
# DevOps 모델
- 소프트웨어 개발과 IT 운영을 결합한 합성어
- 소프트웨어 개발팀과 IT 팀이 안정적으로 소프트웨어를 빌드, 릴리즈할 수 있도록 두 팀간의 프로세스를 자동화하는 일련의 과정

# DevOps의 장점
- 사용자에게 필요한 업데이트를 수행 가능.
개발자는 소비자가 무엇을 원하는지, 운영자는 애플리케이션을 제공하는데 해결할 문제를 인지할 수 있음.
- 컨테이너와 MSA를 사용하면 더 자주 빠르게 릴리즈하는 것이 가능.

# 쿠버네티스의 장점 
- 상태확인 및 자가치유
  - 노드 사용불가 상황이 될 경우 해당 컨테이너를 다른 노드로 이동해서 서비스가 문제없이 구동되도록 할 수 있음.
- 오토스케일링
  - 리소스를 모니터링할 수 있음.
  - 컨테이너 하나가 부하가 심하다고 판단 될 경우, 자동으로 스케일링 할 수 있도록 만들 수 있음.
- 어플리케이션 개발 단순화
  - 버그 발견 및 수정
  - 새로운 버전 출시 시 자동으로 테스트, 이상 발견 시 룰 아웃
- 업데이트를 자동으로 할 수 있는 기능이 있다.
  - 문제가 발생할 경우, 자동으로 롤 아웃


# 컨트롤 플레인
클러스터를 관리하는 기능
마스터 노드에서 실행하거나 여러 노드로 분할되고 고가용성을 보장
- API 서버
  - 컨트롤 플레인과 통신
- 스케쥴러
  - 애플리케이션의 각 구성 요소에 워커 노드를 할당
- 컨트롤 매니저  
  - 구성 요소 복제
  - 워커 노드 추적
  - 노드 장애 처리
- 데이터 스토리지
  - etcd는 클러스터 구성을 지속적으로 저장

# 워커 노드
실제 어플리케이션이 돌아가는 공간, 컨테이너화된 어플리케이션을 실행하는 시스템. 아래의 구성요소를 가짐
- 컨테이너 런타임: 컨테이너를 실행하는 도커
- Kubelet: API 서버와 통신하고 노드에서 컨테이너를 관리
- 어플리케이션 간에 네트워크 트래픽을 분산 및 연결


# 클러스터
## 제어 영역 버전
클라우드 서비스에는 zone(영역)과 region(지역)이 있음. region은 해당 region의 여러 데이터 센터에 분산 배치해 있어 고가용성을 확보할 수 있음

## 노드 풀
클러스터 내의 워커를 설정

## 노드당 pod 개수
노드에 올릴 컨테이너 개수

```
kubectl create deploy nx --image=nginx
kubectl expose deploy nx --type=LoadBalancer
kubectl expose deploy nx --type=LoadBalancer --port=80 --target=80
# 로드벨런서 설정
kubectl expose deploy nx --type=LoadBalancer 
--port=80 --target-port=80 
# 배포되었는지 확인
kubectl get pod,svc
```
